@page "/portfolio"
@using System.Globalization
@implements IDisposable
@inject CultureStateService _cultureStateService
@inject NavigationManager _navigationManager
@inject PortfolioService _portfolioService

<PageTitle>Портфоліо</PageTitle>
<div class="py-5 ec-bg-soft">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-white p-2 mb-4 rounded shadow-sm">
                <li class="breadcrumb-item">
                    <a href="/" class="bread-link">@SharedResource.TextPortfolio_1</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">@SharedResource.TextPortfolio_2</li>
            </ol>
        </nav>
    </div>
    <section id="courses" class="courses section">

        <div class="container">
            <h3 style="padding-top: 5%;"></h3>
            <!-- SECTION TITLE -->
            <div class="section-title text-center mb-5">
                <h2 class="courses-title">@SharedResource.TextPortfolio_3</h2>
                <p class="courses-desc">
                   @*  Практичні курси та заняття, які допоможуть тобі впевнено використовувати англійську в житті та роботі. *@
                </p>
                <hr/>
            </div>

            <div class="row g-4">
                @foreach (var item in filteredPortfolios)
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="course-card h-100">

                            @if (!string.IsNullOrWhiteSpace(item.VideoPath))
                            {
                                <div class="course-card__media">
                                    <div class="ratio ratio-16x9">
                                        <lite-youtube videoid="@item.VideoPath"
                                                      class="card-img-top object-fit-cover">
                                        </lite-youtube>
                                    </div>
                                    <span class="course-category">@item.Group</span>
                                </div>
                            }
                            else
                            {
                                <div class="course-card__img">
                                    <img src="@item.ImgPath" alt="@item.TitleCard">
                                    <span class="course-category">@item.Group</span>
                                </div>
                            }

                            <div class="course-card__body">
                                <h3 class="course-card__title">@item.TitleCard</h3>
                                <p class="course-card__text">@item.DescriptionCard</p>

                                <div class="course-card__footer">
                                    <div class="trainer">
                                        <img src="@item.ImgTeacherPath" alt="">
                                        <span>@SharedResource.TextPortfolio_4</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                }
            </div>


        </div>
    </section>
</div>


@code {

  [CascadingParameter] public MainLayout? Layout { get; set; }
  private List<Portfolio> portfolios = new();
  private List<Portfolio> filteredPortfolios = new();

  protected override async Task OnInitializedAsync()
  {
       _cultureStateService.OnChange += HandleCultureChanged;
                       
       portfolios = await _portfolioService.GetPortfoliosAsync();

       ApplyCulture();
  }

   private void HandleCultureChanged()
   {
       ApplyCulture();
       InvokeAsync(StateHasChanged);
   }

   private void ApplyCulture()
   {
            // false = UA, true = EN
       bool needCulture =
                CultureInfo.CurrentUICulture.TwoLetterISOLanguageName == "en";

       filteredPortfolios = portfolios
                .Where(x => x.IsCulture == needCulture)
                .ToList();
   }

   public void Dispose()
   {
      _cultureStateService.OnChange -= HandleCultureChanged;
   }    

    protected override void OnAfterRender(bool firstRender)
    {
        if (!firstRender) return;

        Layout?.SetSeo(
            "Послуги — English Club W.O.W | Стрий та онлайн",
            "Групові та індивідуальні заняття з англійської для дітей і дорослих. Speaking Club, підготовка до іспитів, онлайн/офлайн навчання."
        );
    }
}
