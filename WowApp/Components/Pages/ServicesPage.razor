@page "/services-page"
@inject ClientService _clientService
@inject CultureStateService _cultureStateService
@inject NavigationManager _navigationManager
@using System.Globalization;

<PageTitle>Послуги</PageTitle>
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-white p-2 mb-4 rounded shadow-sm">
            <li class="breadcrumb-item">
                <a href="/" class="bread-link">@SharedResource.TextServices_1</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">@SharedResource.TextServices_2</li>
        </ol>
    </nav>
</div>

<h3 style="padding-top: 1%;"></h3>
<!-- SECTION TITLE -->
<div class="section-title text-center mb-5">
    <h2 class="courses-title">@SharedResource.TextServices_3</h2>
    <p class="courses-desc">
        @*  Практичні курси та заняття, які допоможуть тобі впевнено використовувати англійську в житті та роботі. *@
    </p>

</div>
<section class="services-hero py-4 py-lg-5">
    <div class="container">
        <div class="services-hero__box">
            <div>
                <span class="badge rounded-pill ec-badge-primary px-3 py-2 mb-3">@SharedResource.TextServices_2</span>
                <h1 class="services-title">@SharedResource.TextServices_3</h1>
                <p class="services-subtitle">
                    @SharedResource.TextServices_5
                </p>
            </div>

           
        </div>
    </div>
</section>

<!-- SERVICES GRID -->
<section class="pt-3 pb-5" id="servicesList">
    <div class="container">

        <div class="section-head text-center mb-4">
            <h2 class="section-title">@SharedResource.TextServices_6</h2>
            <p class="section-desc">
                @SharedResource.TextServices_7
            </p>
        </div>

        <figure class="figure m-0">
            <div class="row g-3">                              

                <!-- Cards -->
                <div class="row g-3 g-lg-4">
                    @foreach (var item in filteredServices)
                    {
                        <div class="col-12 col-sm-6 col-lg-4">
                            <div class="card service-card h-100 shadow-sm">

                                <!-- Image -->
                                <div class="service-media">
                                    <img src="@item.ImgPath"
                                         alt="@item.TitleCard"
                                         loading="lazy" />
                                </div>

                                <!-- Body -->
                                <div class="card-body d-flex flex-column">
                                    <h5 class="fw-bold text-center mb-2">
                                        @item.TitleCard
                                    </h5>

                                    <p class="text-muted text-center mb-3">
                                        @item.DescriptionCard
                                    </p>

                                    <div class="service-mini mt-auto">
                                        <span><i class="bi bi-clock me-1"></i>@item.LessonTime</span>
                                        <span><i class="bi bi-people me-1"></i>@item.Group</span>
                                        <span><i class="bi bi-stars me-1"></i>@($"{item.AgeOfStudent}+")</span>
                                    </div>

                                    <div class="text-center fw-semibold mt-3">
                                        <i class="bi bi-cash-stack me-1"></i>
                                        @item.Price.ToString("N0")  @SharedResource.TextServices_8
                                    </div>

                                    <a href="/appointment-user"
                                       class="btn ec-btn-primary rounded-pill px-4 w-100 mt-3">
                                        @SharedResource.TextServices_9
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>

            </div>
        </figure>
    </div>
</section>

<!-- CTA -->
<section class="pb-5">
    <div class="container">
        <div class="cta-box">
            <div class="cta-text">
                <h3 class="mb-2 fw-bold">@SharedResource.TextServices_10</h3>
                <p class="mb-0">
                    @SharedResource.TextServices_11
                </p>
            </div>
            <div class="cta-actions">
                <a href="/appointment-user" class="btn ec-btn-primary rounded-pill px-4">
                    <i class="bi bi-chat-dots me-1"></i> @SharedResource.TextServices_12
                </a>
                <a href="/callback" class="btn btn-outline-secondary rounded-pill px-3">
                    <i class="bi bi-telephone me-1"></i> @SharedResource.TextServices_13
                </a>
            </div>
        </div>
    </div>
</section>


@code {
    [CascadingParameter] public MainLayout? Layout { get; set; }
    private List<ServiceClient> filteredServices = new();
    private List<ServiceClient> services = new();

    protected override async Task OnInitializedAsync()
    {
        _cultureStateService.OnChange += HandleCultureChanged;
                
        services = await _clientService.GetServiceAsync();

        ApplyCulture();
    }

    private void HandleCultureChanged()
    {
        ApplyCulture();
        InvokeAsync(StateHasChanged);
    }

    private void ApplyCulture()
    {
        // true = EN, false = UA
        bool needCulture = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName == "en";

        filteredServices = services
            .Where(x => x.IsCulture == needCulture)
            .ToList();
    }

    public void Dispose()
    {
        _cultureStateService.OnChange -= HandleCultureChanged;
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (!firstRender) return;

        Layout?.SetSeo(
            "Послуги — English Club WOW | Стрий та онлайн",
            "Групові та індивідуальні заняття з англійської для дітей і дорослих. Speaking Club, підготовка до іспитів, онлайн/офлайн навчання."
        );
    }
}
